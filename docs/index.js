!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).cerbero=t()}(this,(function(){"use strict";var e,t=(e="web-worker-0.js",function(t){return new Worker(e,t)}),n={timeInPage:"timeInPage",selection:"selection",scroll:"scroll",mouseExit:"mouseexit",performance:"performance",click:"click"},i=function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=function(e){var t=e.id;return e.nodeName.toLowerCase()+(t?"#"+t:"")},r=function(e){var t="";return e.parentElement&&(t=r(e.parentElement)),t+" > "+o(e)},s=function(e){var t=e.id,n=e.name,i=e.nodeName,s=e.constructor,a=e.className,c=e.getBoundingClientRect,l={id:t,name:n,className:a,type:i,domType:s.name||"",identifier:o(e),domStructure:r(e),position:c?e.getBoundingClientRect():{}};return e.data&&(l.data=e.data),e.wholeText&&(l.wholeText=e.wholeText),e.nodeValue&&(l.nodeValue=e.nodeValue),e.textContent&&(l.textContent=e.textContent),l},a=function(e){var t,n={},o=window.InputDeviceCapabilities,r=void 0===o?Window:o;for(var a in e)e[a]&&"MemoryInfo"===e[a].constructor.name?n[a]={totalJSHeapSize:(t=e[a]).totalJSHeapSize,usedJSHeapSize:t.usedJSHeapSize,jsHeapSizeLimit:t.jsHeapSizeLimit}:e[a]instanceof Node?n[a]=s(e[a]):e[a]instanceof Window?n[a]="Window":e[a]instanceof r==!1&&"function"!=typeof e[a]&&(n[a]=e[a]);return n.path=null,i({},n)},c=function(e){var t=this;this.cb=function(e){return null},this.selection="",this.getSelectionText=function(){return window.getSelection().toString()},this.observerValue=function(){var e=t.getSelectionText();e!==t.selection&&""!==e&&(t.selection=e,t.cb({event:window.getSelection(),text:t.selection}))},this.cb=e,this.observerValue=this.observerValue.bind(this),setInterval(this.observerValue,2e3)};return new function(){var e=this;if(this.textEncoder=new TextEncoder,this.timeInPageIntervalTime=2500,this.addEventListner=function(t){e.cb=t},this.setTimeInPageInterval=function(t){e.timeInPageIntervalTime=t,clearInterval(e.timeInPageInterval),e.timeInPageInterval=setInterval(e._timeOnPage,e.timeInPageIntervalTime)},this._sendToWorker=function(t,n,i){void 0===i&&(i=!0);var o=i?a(n):n;o.startDate=e.startDate,o=e.textEncoder.encode(JSON.stringify(o)),e.cerberoWorker.postMessage({type:t,event:o})},this._receiveWorkerMessage=function(t){if(!e.cb)throw new Error("[Cerbero] no callback setted");e.cb.apply(null,[t.data])},this._receiveSelectionEvent=function(t){e._sendToWorker(n.selection,{event:a(t.event),selection:t.text},!1)},this._receiveScrollEvent=function(t){var i=document.body,o=document.documentElement;window.clearTimeout(e.isScrolling),e.isScrolling=setTimeout((function(){var r=Math.max(i.scrollHeight,i.offsetHeight,o.clientHeight,o.scrollHeight,o.offsetHeight);e._sendToWorker(n.scroll,{event:a(t),height:r,scroll:window.scrollY||window.pageYOffset},!1)}),100)},this._receiveMouseOutEvent=function(t){var i=t.toElement;i&&"HTML"!==i.nodeName||"HTML"===t.fromElement.nodeName||e._sendToWorker(n.mouseExit,t)},this._timeOnPage=function(){console.log({startTime:e.startDate,nowTime:Date.now()}),e._sendToWorker(n.timeInPage,{startTime:e.startDate,nowTime:Date.now()})},this._initListener=function(){e._sendToWorker(n.performance,window.performance),document.addEventListener("click",(function(t){return e._sendToWorker("click",t)})),window.addEventListener("mouseout",e._receiveMouseOutEvent,!1),new c(e._receiveSelectionEvent),window.addEventListener("scroll",e._receiveScrollEvent,!1),e.cerberoWorker.onmessage=e._receiveWorkerMessage,e.timeInPageInterval=setInterval(e._timeOnPage,e.timeInPageIntervalTime)},"undefined"==typeof Worker)return null;this.startDate=Date.now(),this.cerberoWorker=new t,this._initListener=this._initListener.bind(this),this._sendToWorker=this._sendToWorker.bind(this),this._receiveWorkerMessage=this._receiveWorkerMessage.bind(this),this._receiveSelectionEvent=this._receiveSelectionEvent.bind(this),this._timeOnPage=this._timeOnPage.bind(this),this._initListener()}}));
